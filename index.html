<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google" content="notranslate">
    <title>that38.org</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="css/styles.css?v=20250607212816">
</head>
<body>
    <div id="container">
        <div id="menubar">
            <div class="menu-item" data-menu="file">
                <span>File</span>
                <div class="menu-dropdown">
                    <div class="menu-option" id="menu-new">New</div>
                    <div class="menu-option" id="menu-open">Open...</div>
                    <div class="menu-option" id="menu-save">Save</div>
                    <div class="menu-option" id="menu-save-as">Save As...</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" id="menu-import-org">Import Org Maker (.org)...</div>
                    <div class="menu-option" id="menu-import-midi">Import MIDI (.mid)...</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option has-submenu">
                        <span>Tuned Songs (38 EDO)</span>
                        <span class="submenu-arrow">›</span>
                        <div class="menu-submenu">
                            <div class="menu-option disabled">Coming Soon!</div>
                        </div>
                    </div>
                    <div class="menu-option has-submenu">
                        <span>Untuned Songs (12 EDO)</span>
                        <span class="submenu-arrow">›</span>
                        <div class="menu-submenu">
                            <div class="menu-option" data-org="songs/Pixel/all/">Cave Story (All Songs)...</div>
                            <div class="menu-option" data-org="songs/Pixel/keroblaster/">Kero Blaster (All Songs)...</div>
                            <div class="menu-option" data-midi-dir="songs/classical/">Classical Music...</div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" data-org="songs/Pixel/all/Mischievous Robot.org">Mischievous Robot</div>
                            <div class="menu-option" data-org="songs/Pixel/all/Moonsong.org">Moonsong</div>
                            <div class="menu-option" data-org="songs/Pixel/all/Running Hell.org">Running Hell</div>
                            <div class="menu-option" data-org="songs/Pixel/all/Torokos Theme.org">Torokos Theme</div>
                            <div class="menu-option" data-org="songs/Pixel/all/White.org">White</div>
                            <div class="menu-option" data-org="songs/Pixel/all/Wind Fortress.org">Wind Fortress</div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" id="menu-tuning-help">How to tune a song...?</div>
                        </div>
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-option disabled" id="menu-export">Export Audio...</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option disabled" id="menu-exit">Exit</div>
                </div>
            </div>
            <div class="menu-item" data-menu="edit">
                <span>Edit</span>
                <div class="menu-dropdown">
                    <div class="menu-option disabled" id="menu-undo">Undo</div>
                    <div class="menu-option disabled" id="menu-redo">Redo</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" id="menu-cut">Cut</div>
                    <div class="menu-option" id="menu-copy">Copy</div>
                    <div class="menu-option" id="menu-paste">Paste</div>
                    <div class="menu-option" id="menu-delete">Delete</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" id="menu-select-all">Select All</div>
                </div>
            </div>
            <div class="menu-item" data-menu="view">
                <span>View</span>
                <div class="menu-dropdown">
                    <div class="menu-option disabled" id="menu-zoom-in">Zoom In</div>
                    <div class="menu-option disabled" id="menu-zoom-out">Zoom Out</div>
                    <div class="menu-option disabled" id="menu-zoom-reset">Reset Zoom</div>
                    <div class="menu-separator"></div>
                    <div class="menu-option menu-checkbox" id="menu-grid-snap">
                        <span class="menu-check">✓</span>Grid Snap
                    </div>
                    <div class="menu-option menu-checkbox" id="menu-show-fps">
                        <span class="menu-check">✓</span>Show FPS
                    </div>
                    <div class="menu-option menu-checkbox" id="menu-follow-mode">
                        <span class="menu-check">✓</span>Follow Playback
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-option" id="menu-track-info">Track Information...</div>
                </div>
            </div>
            <div class="menu-item" data-menu="tools">
                <span>Tools</span>
                <div class="menu-dropdown">
                    <div class="menu-option" id="menu-clear-all">Clear All Notes</div>
                    <div class="menu-option disabled" id="menu-transpose">Transpose...</div>
                    <div class="menu-option disabled" id="menu-quantize">Quantize</div>
                </div>
            </div>
            <div class="menu-item" data-menu="help">
                <span>Help</span>
                <div class="menu-dropdown">
                    <div class="menu-option" id="menu-shortcuts">Keyboard Shortcuts</div>
                    <div class="menu-option" id="menu-about">About</div>
                </div>
            </div>
            
            <div class="menu-spacer"></div>
            
            <div class="menu-instrument-selector">
                <label>Voice:</label>
                <select id="waveformSelect">
                    <!-- Options will be populated dynamically -->
                </select>
                <span id="instrumentColorIndicator"></span>
            </div>
        </div>
        
        <div id="controls">
            <h1>that38.org</h1>
            
            <div class="control-group transport">
                <button id="playBtn" title="Play/Pause">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path id="playIcon" d="M4 2 L4 14 L13 8 Z"/>
                        <path id="pauseIcon" d="M4 2 L4 14 L6 14 L6 2 Z M10 2 L10 14 L12 14 L12 2 Z" style="display: none;"/>
                    </svg>
                </button>
                <button id="stopBtn" title="Stop">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="3" y="3" width="10" height="10"/>
                    </svg>
                </button>
            </div>
            
            <div class="control-group volume-group">
                <label>
                    Volume: <input type="range" id="volumeSlider" min="0" max="100" step="1" value="30">
                </label>
            </div>
            
            <div class="control-group snap-mode-group">
                <button id="snapModeBtn" class="snap-mode-button" title="Toggle High-Resolution Snap Mode">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="1" y="6" width="2" height="4"/>
                        <rect x="5" y="6" width="2" height="4"/>
                        <rect x="9" y="6" width="2" height="4"/>
                        <rect x="13" y="6" width="2" height="4"/>
                    </svg>
                    <span>Snap: Normal</span>
                </button>
            </div>
            
            <div class="control-spacer"></div>
            
            <div class="control-group loop">
                <button id="loopBtn" title="Toggle Loop">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M4 4v3h8V4l3 4-3 4V9H3V4h1zm8 8v-3H4v3l-3-4 3-4v3h9v5h-1z"/>
                    </svg>
                </button>
                <div class="loop-range-container">
                    <span>Loop:</span>
                    <input type="number" id="loopStartInput" min="1" max="256" value="1">
                    <span>–</span>
                    <input type="number" id="loopEndInput" min="1" max="256" value="5">
                </div>
            </div>
        </div>
        
        <div id="canvas-container">
            <canvas id="pianoRoll"></canvas>
        </div>
        <div id="pan-bar">
            <div id="pan-container">
                <canvas id="panCanvas"></canvas>
            </div>
        </div>
        <div id="velocity-bar">
            <div id="velocity-container">
                <canvas id="velocityCanvas"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Song Selection Modal -->
    <div id="songModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Select a Song</h2>
                <button class="modal-close">&times;</button>
            </div>
            <ul class="song-list" id="songList">
                <!-- Songs will be populated here -->
            </ul>
        </div>
    </div>
    
    <!-- Info Modal (for About, Shortcuts, etc) -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="infoModalTitle">Information</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="info-modal" id="infoModalContent">
                <!-- Content will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Confirm Action</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="confirm-dialog">
                <div class="confirm-message" id="confirmMessage">Are you sure?</div>
                <div class="confirm-buttons">
                    <button class="confirm-no">Cancel</button>
                    <button class="confirm-yes">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Save As Modal -->
    <div id="saveAsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Save As</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="save-as-dialog">
                <label for="saveAsFilename">Filename:</label>
                <input type="text" id="saveAsFilename" placeholder="Enter filename" value="song.json">
                <div class="save-as-buttons">
                    <button class="save-as-cancel">Cancel</button>
                    <button class="save-as-confirm">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Track Info Modal -->
    <div id="trackInfoModal" class="modal">
        <div class="modal-content track-info-modal">
            <div class="modal-header">
                <h2 class="modal-title">Track Information</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="trackInfoContent"></div>
        </div>
    </div>
    
    <!-- Tuning Help Modal -->
    <div id="tuningHelpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">How to Tune a Song for 38 EDO</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px; line-height: 1.6;">
                <p><strong>Why do imported songs sound out of tune?</strong></p>
                <p>This piano roll uses 38 equal divisions of the octave (38 EDO), which provides much finer pitch control than standard 12-tone music. However, the 12 standard notes don't align perfectly with 38 EDO's grid - they land on positions that create a specific temperament.</p>
                
                <p><strong>The current temperament uses these positions:</strong></p>
                <ul style="font-family: monospace; margin: 10px 0;">
                    <li>C = 0, C# = 3, D = 6, D# = 9, E = 12, F = 15</li>
                    <li>F# = 18, G = 22, G# = 25, A = 28, A# = 31, B = 34</li>
                </ul>
                
                <p><strong>How to tune a song:</strong></p>
                <ol style="margin: 10px 0;">
                    <li>Some notes may need to be shifted up or down by 1-2 steps to sound correct</li>
                    <li>Listen for notes that sound "sour" or create unwanted beating</li>
                    <li>Try moving these notes up or down one 38 EDO step at a time</li>
                    <li>Chords may need different adjustments than melodic lines</li>
                    <li>Trust your ears - the goal is to make it sound good to you!</li>
                </ol>
                
                <p><strong>Tip:</strong> When creating or editing music in 38-EDO, microtonal arrow indicators help identify notes between standard pitches.</p>
            </div>
        </div>
    </div>
    
    <!-- About content (hidden, for SEO) -->
    <div id="aboutContent" style="display: none;">
        <div class="about-container">
            <h2 style="margin-top: 0; color: #4a9eff;">that38.org</h2>
            <p style="color: #ccc; margin-bottom: 20px;">38-EDO Microtonal Sequencer</p>
            
            <p>A piano roll sequencer with 38 equal divisions per octave (31.58 cents per step) for xenharmonic music.</p>
            
            <h3>Features</h3>
            <ul style="list-style: none; padding: 0;">
                <li>• 8 octaves of 38-EDO tuning</li>
                <li>• Import .org and .mid files</li>
                <li>• 100 wavetable instruments + 6 drums</li>
                <li>• Per-note velocity and pan</li>
                <li>• 256 measures with loop points</li>
            </ul>
            
            <p style="margin-top: 20px; color: #888; font-size: 12px;">
            Wavetable engine from Org Maker<br>
            Cave Story music by Pixel<br>
            Kero Blaster Org transcriptions by Alula
            </p>
        </div>
    </div>
    
    <!-- Load JavaScript modules -->
    <script type="module" src="js/main.js?v=20250607212816"></script>
</body>
</html>